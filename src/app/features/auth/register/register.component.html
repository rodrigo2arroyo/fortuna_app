<div class="md:hidden">
  <div class="relative z-10 mt-6 px-6 pb-12">
    @switch (step()) {
      @case ('identidad') {
        <div class="w-full text-[#1a202c]">
          <button
            type="button"
            class="inline-flex items-center gap-2 mb-6 px-4 py-2 rounded-full border border-gray-200 text-sm font-medium text-gray-700 hover:bg-gray-50"
            (click)="goBackToLogin()"
          >
            <span class="text-lg leading-none">‚Üê</span>
            Atr√°s
          </button>

          <div class="mb-6">
            <img
              src="./assets/text/FULL.png"
              alt="Fortuna"
              class="h-10 object-contain"
            />
          </div>

          <h2 class="text-[22px] font-bold leading-[28px] max-w-[260px]">
            ¬øEs tu primera vez?<br />
            Vamos a crear tu cuenta Fortuna
          </h2>

          <div class="mt-6">
            <label class="block text-[13px] font-medium text-gray-600 mb-2">
              Documentos de identidad (DNI)
            </label>

            <input
              type="text"
              maxlength="8"
              inputmode="numeric"
              placeholder="00000000"
              class="w-full rounded-xl border border-gray-200 bg-white px-4 py-3 text-[16px] outline-none focus:ring-2 focus:ring-[#ffa101]"
              [ngModel]="dni()"
              (ngModelChange)="dni.set($event)"
            />
          </div>

          <div class="flex items-start gap-3 mt-5">
            <input
              type="checkbox"
              class="mt-1 w-5 h-5 accent-[#ffa101]"
              [checked]="accepted()"
              (change)="accepted.set(($any($event.target).checked))"
            />
            <p class="text-[12px] text-gray-500 leading-5">
              Doy mi consentimiento para el procesamiento de mis datos personales de acuerdo con la
              <a href="https://fortuna.com.pe/politica-de-privacidad" target="_blank" class="underline font-semibold text-gray-700">
                Pol√≠tica de Privacidad
              </a>
              y los
              <a href="https://fortuna.com.pe/terminos-y-condiciones" target="_blank" class="underline font-semibold text-gray-700">
                T√©rminos y Condiciones
              </a>.
            </p>
          </div>

          <!-- CTA disabled like mock -->
          <div class="mt-8">
            <button
              type="button"
              class="w-full h-12 rounded-full font-semibold flex items-center justify-center gap-2
               disabled:cursor-not-allowed"
              [disabled]="!dniValid() || !accepted() || loadingDni()"
              [class.bg-[#0a0d12]]="dniValid() && accepted() && !loadingDni()"
              [class.text-white]="dniValid() && accepted() && !loadingDni()"
              [class.bg-gray-200]="!(dniValid() && accepted() && !loadingDni())"
              [class.text-gray-400]="!(dniValid() && accepted() && !loadingDni())"
              (click)="next()"
            >
              {{ loadingDni() ? 'Validando...' : 'Siguiente' }}
              <span class="text-lg leading-none">‚Üí</span>
            </button>
          </div>

        </div>
      }
      @case ('datos') {
        <button
          type="button"
          class="inline-flex items-center gap-2 mb-6 px-4 py-2 rounded-full border border-gray-200 text-sm font-medium text-gray-700 hover:bg-gray-50"
          (click)="goBackToLogin()"
        >
          <span class="text-lg leading-none">‚Üê</span>
          Atr√°s
        </button>
        <div class="w-full max-w-md mx-auto text-[#1a202c]" [formGroup]="datosForm">
          <h2 class="text-[22px] font-bold leading-[30px] mb-1">
            Completa tus datos
          </h2>
          <p class="text-sm text-gray-600 mb-6">
            Para acceder a nuestro pr√©stamo, por favor, ingresa la informaci√≥n necesaria para continuar con tu solicitud.
          </p>

          <div class="w-full mb-6 rounded-xl border border-[#c6d7ff] bg-[#f5f7ff] px-4 py-2.5 text-[13px] leading-5 text-gray-800">
            <div class="font-semibold">
              Monto a solicitar:
            </div>
            <div>
              300 ‚Äì Pagando con 6 cuotas ‚Äì Tipo:
              <span class="font-semibold">
              PR√âSTAMO NEGOCIO FAMILIAR
            </span>
            </div>
          </div>

          <div class="flex flex-col gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">
                Documentos de identidad (DNI)
              </label>
              <input
                type="text"
                [value]="dni()"
                readonly
                class="w-full rounded-xl border border-gray-300 bg-gray-50 px-4 py-2.5 text-[15px] text-gray-500 outline-none"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Nombres</label>
              <input
                type="text"
                formControlName="nombres"
                placeholder="Martha Mar√≠a"
                readonly
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101] text-gray-500"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Apellidos</label>
              <input
                type="text"
                formControlName="apellidos"
                readonly
                placeholder="L√≥pez Guti√©rrez"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101] text-gray-500"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">
                Empresa o instituci√≥n donde trabaja actualmente
              </label>
              <input
                type="text"
                formControlName="empresaTrabajo"
                placeholder="Empresa o instituci√≥n donde trabaja actualmente"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Ingreso mensual</label>
              <input
                type="number"
                formControlName="ingresoMensual"
                min="1300"
                placeholder="Desde S/1300"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
              <p class="text-xs text-[#2563eb] mt-1">
                Monto sujeto a verificaci√≥n mediante boletas o recibo por honorarios.
              </p>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Ocupaci√≥n</label>
              <input
                type="text"
                formControlName="ocupacion"
                placeholder="Escribir ocupaci√≥n"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Estado civil</label>
              <select
                formControlName="estadoCivil"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              >
                <option value="">Seleccionar</option>
                <option value="1">Soltero</option>
                <option value="2">Casado</option>
                <option value="3">Conviviente</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Grado de instrucci√≥n</label>
              <select
                formControlName="gradoInstruccion"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              >
                <option value="">Seleccionar</option>
                <option value="3">Primaria</option>
                <option value="4">Secundaria</option>
                <option value="5">T√©cnico profesional</option>
                <option value="10">Superior completo</option>
                <option value="11">Superior incompleto</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">
                ¬øQu√© d√≠a del mes le gustar√≠a pagar su cuota?
              </label>
              <select
                formControlName="diaPago"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              >
                <option value="">Seleccione</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Celular</label>
              <input
                type="tel"
                formControlName="celular"
                placeholder="Escribe tu n√∫mero"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">Correo</label>
              <input
                type="email"
                formControlName="correo"
                placeholder="Escribe tu correo electr√≥nico"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">¬øC√≥mo nos conociste?</label>
              <select
                formControlName="comoConociste"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              >
                <option value="">Seleccionar</option>
                <option value="15">Web de Fortuna</option>
                <option value="16">Recomendaci√≥n</option>
                <option value="25">Letrero de Fortuna</option>
                <option value="26">Facebook</option>
                <option value="27">Instagram</option>
                <option value="28">Google</option>
                <option value="29">LinkedIn</option>
                <option value="30">Correo electr√≥nico</option>
                <option value="31">Televisi√≥n y Radio</option>
                <option value="32">Peri√≥dicos y Revistas</option>
              </select>
            </div>
            <h2 class="text-[22px] font-bold leading-[30px] mb-1">
              Domicilio seg√∫n DNI
            </h2>
            <div>
              <label class="block text-sm font-medium mb-1">Departamento seg√∫n DNI</label>

              <select
                class="w-full rounded-xl border px-4 py-2.5 bg-gray-50 border-gray-300 text-[15px]"
                [value]="datosForm.get('departamentoDni')?.value || ''"
                (change)="onDepartamentoChange(($any($event.target).value))"
              >
                <option value="" disabled>
                  @if (loadingDep()) { Cargando... } @else { Selecciona un departamento }
                </option>

                @for (dep of departamentos(); track dep) {
                  <option [value]="dep">{{ dep }}</option>
                }
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Provincia seg√∫n DNI</label>

              <select
                class="w-full rounded-xl border px-4 py-2.5 bg-gray-50 border-gray-300 text-[15px]"
                [disabled]="!datosForm.get('departamentoDni')?.value || loadingProv()"
                [value]="datosForm.get('provinciaDni')?.value || ''"
                (change)="onProvinciaChange(($any($event.target).value))"
              >
                <option value="" disabled>
                  @if (!datosForm.get('departamentoDni')?.value) { Primero elige un departamento }
                  @else if (loadingProv()) { Cargando... }
                  @else { Selecciona una provincia }
                </option>

                @for (prov of provincias(); track prov) {
                  <option [value]="prov">{{ prov }}</option>
                }
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Distrito seg√∫n DNI</label>

              <select
                class="w-full rounded-xl border px-4 py-2.5 bg-gray-50 border-gray-300 text-[15px]"
                [disabled]="!datosForm.get('provinciaDni')?.value || loadingDist()"
                [value]="datosForm.get('distritoDni')?.value || ''"
                (change)="onDistritoChange(($any($event.target).value))"
              >
                <option value="" disabled>
                  @if (!datosForm.get('provinciaDni')?.value) { Primero elige una provincia }
                  @else if (loadingDist()) { Cargando... }
                  @else { Selecciona un distrito }
                </option>

                @for (dist of distritos(); track dist) {
                  <option [value]="dist">{{ dist }}</option>
                }
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Domicilio seg√∫n DNI</label>
              <input
                formControlName="domicilioDni"
                type="text"
                class="w-full rounded-xl border px-4 py-2.5 bg-gray-50 border-gray-300 text-[15px]"
                placeholder="Domicilio seg√∫n DNI"
              />
            </div>
          </div>
          <div class="mt-8 flex items-end justify-end">
            <div class="mt-8 flex items-end justify-end">
              <button
                type="button"
                class="rounded-full px-8 py-3 bg-[#0a0d12] text-white font-semibold flex disabled:opacity-40 disabled:cursor-not-allowed"
                [disabled]="datosForm.invalid || loadingSms()"
                (click)="next()"
              >
                @if (loadingSms()) { Enviando c√≥digo... } @else { Siguiente ‚Üí }
              </button>

              @if (smsError()) {
                <p class="mt-2 text-sm text-red-600 text-right">{{ smsError() }}</p>
              }
            </div>
          </div>
        </div>
      }
      @case ('verificacion') {
        <div class="w-full max-w-md mx-auto text-[#1a202c]" [formGroup]="otpForm">
          <button
            type="button"
            class="inline-flex items-center gap-2 mb-8 px-4 py-2 rounded-full border border-gray-200 text-sm hover:bg-gray-50"
            (click)="prev()"
          >
            <span class="text-lg">‚Üê</span>
            <span class="font-medium">Atr√°s</span>
          </button>

          <h2 class="text-[22px] font-bold leading-[30px] mb-2">
            Verificaci√≥n de tu celular
          </h2>
          <p class="text-sm text-gray-600 mb-8">
            Se ha enviado un c√≥digo a su celular {{ celularMasked }}
          </p>

          <div class="flex items-center justify-between gap-3 mb-8">
            <input
              type="text"
              maxlength="1"
              formControlName="d1"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d2, null)"
              #d1
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d2"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d3, d1)"
              #d2
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d3"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d4, d2)"
              #d3
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d4"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d5, d3)"
              #d4
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d5"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d6, d4)"
              #d5
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d6"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, null, d5)"
              #d6
            />
          </div>

          <button
            type="button"
            class="w-full flex items-center justify-center gap-2 rounded-full px-6 py-3
         bg-[#0a0d12] text-white font-semibold
         disabled:opacity-40 disabled:cursor-not-allowed mb-2"
            [disabled]="!otpValid || verifyingOtp()"
            (click)="verifyAndCreate()"
          >
            @if (verifyingOtp()) {
              Verificando...
            } @else {
              Verificar y crear cuenta ‚Üí
            }
          </button>

          <button
            type="button"
            class="w-full rounded-full px-6 py-3 border border-gray-300 text-sm font-medium
         disabled:text-gray-400 disabled:border-gray-200 disabled:cursor-not-allowed"
            [disabled]="countdown() > 0 || resendingOtp()"
            (click)="resendCode()"
          >
            @if (resendingOtp()) {
              Reenviando...
            } @else if (countdown() > 0) {
              Reenviar c√≥digo {{ countdownText() }}
            } @else {
              Reenviar c√≥digo
            }
          </button>
        </div>
      }
      @case ('credenciales') {
        <div class="w-full max-w-md mx-auto text-[#1a202c]" [formGroup]="credencialesForm">
          <button
            type="button"
            class="inline-flex items-center gap-2 mb-8 px-4 py-2 rounded-full border border-gray-200 text-sm hover:bg-gray-50"
            (click)="prev()"
          >
            <span class="text-lg">‚Üê</span>
            <span class="font-medium">Atr√°s</span>
          </button>

          <h2 class="text-[22px] font-bold leading-[30px] mb-6">
            Crea una contrase√±a
          </h2>

          <div class="flex flex-col gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">Ingresa tu contrase√±a</label>

              <div class="relative">
                <input
                  [type]="showPassword() ? 'text' : 'password'"
                  formControlName="password"
                  placeholder="Contrase√±a"
                  class="w-full rounded-xl border border-gray-300 bg-gray-50 px-4 py-2.5 text-[15px]
             outline-none focus:ring-2 focus:ring-[#ffa101]"
                />

                <button
                  type="button"
                  class="absolute inset-y-0 right-3 flex items-center justify-center"
                  (click)="showPassword.set(!showPassword())"
                  aria-label="Mostrar/Ocultar contrase√±a"
                  title="Mostrar/Ocultar contrase√±a"
                >
                  @if (showPassword()) {
                    <img src="assets/icons/eye-off-line.svg" class="w-5 h-5" alt="Ocultar contrase√±a" />
                  } @else {
                    üëÅÔ∏è
                  }
                </button>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">Confirma tu contrase√±a</label>
              <div class="relative">
                <input
                  [type]="showPasswordConfirm() ? 'text' : 'password'"
                  formControlName="passwordConfirm"
                  placeholder="Contrase√±a"
                  class="w-full rounded-xl border border-gray-300 bg-gray-50 px-4 py-2.5 text-[15px]
                   outline-none focus:ring-2 focus:ring-[#ffa101]"
                />
                <button
                  type="button"
                  class="absolute inset-y-0 right-3 flex items-center text-gray-400 text-sm"
                  (click)="showPasswordConfirm.set(!showPasswordConfirm())"
                >
                  @if (showPasswordConfirm()) {
                    <img src="assets/icons/eye-off-line.svg" class="w-5 h-5" alt="Ocultar contrase√±a" />
                  } @else {
                    üëÅÔ∏è
                  }
                </button>
              </div>

              @if (passwordMismatch()) {
                <p class="mt-1 text-xs text-red-500">
                  Las contrase√±as no coinciden.
                </p>
              }
            </div>
          </div>

          <div class="mt-8">
            <button
              type="button"
              class="w-full rounded-full px-6 py-3 bg-[#0a0d12] text-white font-semibold disabled:opacity-40 disabled:cursor-not-allowed"
              [disabled]="isLoading() || datosForm.invalid || credencialesForm.invalid"
              (click)="finish()"
            >
              @if (isLoading()) { Registrando... } @else { Confirmar }
            </button>
          </div>
        </div>
      }
    }
  </div>
</div>

<div class="hidden md:block">
  <div class="w-full max-w-xl">
    @switch (step()) {
      @case ('identidad') {
        <div class="w-full max-w-md text-[#1a202c]">
          <button
            type="button"
            class="inline-flex items-center gap-2 mb-6 px-4 py-2 rounded-full border border-gray-200 text-sm font-medium text-gray-700 hover:bg-gray-50"
            (click)="goBackToLogin()"
          >
            <span class="text-lg leading-none">‚Üê</span>
            Atr√°s
          </button>

          <div class="mb-6">
            <img
              src="./assets/text/FULL.png"
              alt="Fortuna"
              class="h-10 object-contain"
            />
          </div>

          <h2 class="text-[22px] font-bold leading-[30px] mb-1">
            ¬øEs tu primera vez?
          </h2>
          <h3 class="text-[22px] font-bold leading-[30px] mb-6">
            Vamos a crear tu cuenta Fortuna
          </h3>

          <label class="block text-[14px] font-medium mb-2">Documento de identidad (DNI)</label>
          <input
            type="text"
            maxlength="8"
            inputmode="numeric"
            placeholder="00000000"
            class="w-full rounded-xl border border-gray-300 bg-gray-50 px-4 py-3 text-[16px] outline-none focus:ring-2 focus:ring-[#ffa101]"
            [ngModel]="dni()"
            (ngModelChange)="dni.set($event)"
          />

          <div class="flex items-start gap-3 mt-4">
            <input
              type="checkbox"
              class="mt-1 accent-[#ffa101] w-5 h-5"
              [checked]="accepted()"
              (change)="accepted.set(($any($event.target).checked))"
            />
            <label for="terms" class="text-sm text-gray-700 leading-5">
              Doy mi consentimiento para el procesamiento de mis datos personales de acuerdo con la
              <a href="https://fortuna.com.pe/politica-de-privacidad" target="_blank" class="underline font-medium">
                Pol√≠tica de Privacidad
              </a>
              y los
              <a href="https://fortuna.com.pe/terminos-y-condiciones" target="_blank" class="underline font-medium">
                T√©rminos y Condiciones
              </a>.
            </label>
          </div>

          <div class="mt-8">
            <button
              type="button"
              class="w-full flex items-center justify-center gap-2 rounded-full px-6 py-3 bg-[#0a0d12] text-white font-semibold disabled:opacity-40 disabled:cursor-not-allowed"
              [disabled]="!dniValid() || !accepted() || loadingDni()"
              (click)="next()"
            >
              {{ loadingDni() ? 'Validando...' : 'Siguiente ‚Üí' }}
            </button>
          </div>
        </div>
      }
      @case ('datos') {
        <div class="w-full max-w-md mx-auto text-[#1a202c]" [formGroup]="datosForm">
          <h2 class="text-[22px] font-bold leading-[30px] mb-1">
            Completa tus datos
          </h2>
          <p class="text-sm text-gray-600 mb-6">
            Para acceder a nuestro pr√©stamo, por favor, ingresa la informaci√≥n necesaria para continuar con tu solicitud.
          </p>

          <div class="w-full mb-6 rounded-xl border border-[#c6d7ff] bg-[#f5f7ff] px-4 py-2.5 text-[13px] leading-5 text-gray-800">
            <div class="font-semibold">
              Monto a solicitar:
            </div>
            <div>
              300 ‚Äì Pagando con 6 cuotas ‚Äì Tipo:
              <span class="font-semibold">
              PR√âSTAMO NEGOCIO FAMILIAR
            </span>
            </div>
          </div>

          <div class="flex flex-col gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">
                Documentos de identidad (DNI)
              </label>
              <input
                type="text"
                [value]="dni()"
                readonly
                class="w-full rounded-xl border border-gray-300 bg-gray-50 px-4 py-2.5 text-[15px] text-gray-500 outline-none"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Nombres</label>
              <input
                type="text"
                formControlName="nombres"
                placeholder="Martha Mar√≠a"
                readonly
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101] text-gray-500"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Apellidos</label>
              <input
                type="text"
                formControlName="apellidos"
                readonly
                placeholder="L√≥pez Guti√©rrez"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101] text-gray-500"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">
                Empresa o instituci√≥n donde trabaja actualmente
              </label>
              <input
                type="text"
                formControlName="empresaTrabajo"
                placeholder="Empresa o instituci√≥n donde trabaja actualmente"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Ingreso mensual</label>
              <input
                type="number"
                formControlName="ingresoMensual"
                min="1300"
                placeholder="Desde S/1300"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
              <p class="text-xs text-[#2563eb] mt-1">
                Monto sujeto a verificaci√≥n mediante boletas o recibo por honorarios.
              </p>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Ocupaci√≥n</label>
              <input
                type="text"
                formControlName="ocupacion"
                placeholder="Escribir ocupaci√≥n"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Estado civil</label>
              <select
                formControlName="estadoCivil"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              >
                <option value="">Seleccionar</option>
                <option value="1">Soltero</option>
                <option value="2">Casado</option>
                <option value="3">Conviviente</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Grado de instrucci√≥n</label>
              <select
                formControlName="gradoInstruccion"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              >
                <option value="">Seleccionar</option>
                <option value="3">Primaria</option>
                <option value="4">Secundaria</option>
                <option value="5">T√©cnico profesional</option>
                <option value="10">Superior completo</option>
                <option value="11">Superior incompleto</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">
                ¬øQu√© d√≠a del mes le gustar√≠a pagar su cuota?
              </label>
              <select
                formControlName="diaPago"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              >
                <option value="">Seleccione</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="25">25</option>
                <option value="26">26</option>
                <option value="27">27</option>
                <option value="28">28</option>
                <option value="29">29</option>
                <option value="30">30</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Celular</label>
              <input
                type="tel"
                formControlName="celular"
                placeholder="Escribe tu n√∫mero"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">Correo</label>
              <input
                type="email"
                formControlName="correo"
                placeholder="Escribe tu correo electr√≥nico"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
                 bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">¬øC√≥mo nos conociste?</label>
              <select
                formControlName="comoConociste"
                class="w-full rounded-xl border px-4 py-2.5 text-[15px] outline-none
           bg-gray-50 border-gray-300 focus:ring-2 focus:ring-[#ffa101]"
              >
                <option value="">Seleccionar</option>
                <option value="15">Web de Fortuna</option>
                <option value="16">Recomendaci√≥n</option>
                <option value="25">Letrero de Fortuna</option>
                <option value="26">Facebook</option>
                <option value="27">Instagram</option>
                <option value="28">Google</option>
                <option value="29">LinkedIn</option>
                <option value="30">Correo electr√≥nico</option>
                <option value="31">Televisi√≥n y Radio</option>
                <option value="32">Peri√≥dicos y Revistas</option>
              </select>
            </div>
            <h2 class="text-[22px] font-bold leading-[30px] mb-1">
              Domicilio seg√∫n DNI
            </h2>
            <div>
              <label class="block text-sm font-medium mb-1">Departamento seg√∫n DNI</label>

              <select
                class="w-full rounded-xl border px-4 py-2.5 bg-gray-50 border-gray-300 text-[15px]"
                [value]="datosForm.get('departamentoDni')?.value || ''"
                (change)="onDepartamentoChange(($any($event.target).value))"
              >
                <option value="" disabled>
                  @if (loadingDep()) { Cargando... } @else { Selecciona un departamento }
                </option>

                @for (dep of departamentos(); track dep) {
                  <option [value]="dep">{{ dep }}</option>
                }
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Provincia seg√∫n DNI</label>

              <select
                class="w-full rounded-xl border px-4 py-2.5 bg-gray-50 border-gray-300 text-[15px]"
                [disabled]="!datosForm.get('departamentoDni')?.value || loadingProv()"
                [value]="datosForm.get('provinciaDni')?.value || ''"
                (change)="onProvinciaChange(($any($event.target).value))"
              >
                <option value="" disabled>
                  @if (!datosForm.get('departamentoDni')?.value) { Primero elige un departamento }
                  @else if (loadingProv()) { Cargando... }
                  @else { Selecciona una provincia }
                </option>

                @for (prov of provincias(); track prov) {
                  <option [value]="prov">{{ prov }}</option>
                }
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Distrito seg√∫n DNI</label>

              <select
                class="w-full rounded-xl border px-4 py-2.5 bg-gray-50 border-gray-300 text-[15px]"
                [disabled]="!datosForm.get('provinciaDni')?.value || loadingDist()"
                [value]="datosForm.get('distritoDni')?.value || ''"
                (change)="onDistritoChange(($any($event.target).value))"
              >
                <option value="" disabled>
                  @if (!datosForm.get('provinciaDni')?.value) { Primero elige una provincia }
                  @else if (loadingDist()) { Cargando... }
                  @else { Selecciona un distrito }
                </option>

                @for (dist of distritos(); track dist) {
                  <option [value]="dist">{{ dist }}</option>
                }
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Domicilio seg√∫n DNI</label>
              <input
                formControlName="domicilioDni"
                type="text"
                class="w-full rounded-xl border px-4 py-2.5 bg-gray-50 border-gray-300 text-[15px]"
                placeholder="Domicilio seg√∫n DNI"
              />
            </div>
          </div>
          <div class="mt-8 flex items-end justify-end">
            <div class="mt-8 flex items-end justify-end">
              <button
                type="button"
                class="rounded-full px-8 py-3 bg-[#0a0d12] text-white font-semibold flex disabled:opacity-40 disabled:cursor-not-allowed"
                [disabled]="datosForm.invalid || loadingSms()"
                (click)="next()"
              >
                @if (loadingSms()) { Enviando c√≥digo... } @else { Siguiente ‚Üí }
              </button>

              @if (smsError()) {
                <p class="mt-2 text-sm text-red-600 text-right">{{ smsError() }}</p>
              }
            </div>
          </div>
        </div>
      }
      @case ('verificacion') {
        <div class="w-full max-w-md mx-auto text-[#1a202c]" [formGroup]="otpForm">
          <button
            type="button"
            class="inline-flex items-center gap-2 mb-8 px-4 py-2 rounded-full border border-gray-200 text-sm hover:bg-gray-50"
            (click)="prev()"
          >
            <span class="text-lg">‚Üê</span>
            <span class="font-medium">Atr√°s</span>
          </button>

          <h2 class="text-[22px] font-bold leading-[30px] mb-2">
            Verificaci√≥n de tu celular
          </h2>
          <p class="text-sm text-gray-600 mb-8">
            Se ha enviado un c√≥digo a su celular {{ celularMasked }}
          </p>

          <div class="flex items-center justify-between gap-3 mb-8">
            <input
              type="text"
              maxlength="1"
              formControlName="d1"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d2, null)"
              #d1
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d2"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d3, d1)"
              #d2
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d3"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d4, d2)"
              #d3
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d4"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d5, d3)"
              #d4
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d5"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, d6, d4)"
              #d5
            />
            <input
              type="text"
              maxlength="1"
              formControlName="d6"
              class="w-12 h-14 rounded-xl border border-gray-300 bg-gray-50 text-center text-xl font-medium outline-none focus:ring-2 focus:ring-[#ffa101]"
              (input)="onOtpInput($event, null, d5)"
              #d6
            />
          </div>

          <button
            type="button"
            class="w-full flex items-center justify-center gap-2 rounded-full px-6 py-3
         bg-[#0a0d12] text-white font-semibold
         disabled:opacity-40 disabled:cursor-not-allowed mb-2"
            [disabled]="!otpValid || verifyingOtp()"
            (click)="verifyAndCreate()"
          >
            @if (verifyingOtp()) {
              Verificando...
            } @else {
              Verificar y crear cuenta ‚Üí
            }
          </button>

          <button
            type="button"
            class="w-full rounded-full px-6 py-3 border border-gray-300 text-sm font-medium
         disabled:text-gray-400 disabled:border-gray-200 disabled:cursor-not-allowed"
            [disabled]="countdown() > 0 || resendingOtp()"
            (click)="resendCode()"
          >
            @if (resendingOtp()) {
              Reenviando...
            } @else if (countdown() > 0) {
              Reenviar c√≥digo {{ countdownText() }}
            } @else {
              Reenviar c√≥digo
            }
          </button>
        </div>
      }
      @case ('credenciales') {
        <div class="w-full max-w-md mx-auto text-[#1a202c]" [formGroup]="credencialesForm">
          <button
            type="button"
            class="inline-flex items-center gap-2 mb-8 px-4 py-2 rounded-full border border-gray-200 text-sm hover:bg-gray-50"
            (click)="prev()"
          >
            <span class="text-lg">‚Üê</span>
            <span class="font-medium">Atr√°s</span>
          </button>

          <h2 class="text-[22px] font-bold leading-[30px] mb-6">
            Crea una contrase√±a
          </h2>

          <div class="flex flex-col gap-4">
            <div>
              <label class="block text-sm font-medium mb-1">Ingresa tu contrase√±a</label>

              <div class="relative">
                <input
                  [type]="showPassword() ? 'text' : 'password'"
                  formControlName="password"
                  placeholder="Contrase√±a"
                  class="w-full rounded-xl border border-gray-300 bg-gray-50 px-4 py-2.5 text-[15px]
             outline-none focus:ring-2 focus:ring-[#ffa101]"
                />

                <button
                  type="button"
                  class="absolute inset-y-0 right-3 flex items-center justify-center"
                  (click)="showPassword.set(!showPassword())"
                  aria-label="Mostrar/Ocultar contrase√±a"
                  title="Mostrar/Ocultar contrase√±a"
                >
                  @if (showPassword()) {
                    <img src="assets/icons/eye-off-line.svg" class="w-5 h-5" alt="Ocultar contrase√±a" />
                  } @else {
                    üëÅÔ∏è
                  }
                </button>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">Confirma tu contrase√±a</label>
              <div class="relative">
                <input
                  [type]="showPasswordConfirm() ? 'text' : 'password'"
                  formControlName="passwordConfirm"
                  placeholder="Contrase√±a"
                  class="w-full rounded-xl border border-gray-300 bg-gray-50 px-4 py-2.5 text-[15px]
                   outline-none focus:ring-2 focus:ring-[#ffa101]"
                />
                <button
                  type="button"
                  class="absolute inset-y-0 right-3 flex items-center text-gray-400 text-sm"
                  (click)="showPasswordConfirm.set(!showPasswordConfirm())"
                >
                  @if (showPasswordConfirm()) {
                    <img src="assets/icons/eye-off-line.svg" class="w-5 h-5" alt="Ocultar contrase√±a" />
                  } @else {
                    üëÅÔ∏è
                  }
                </button>
              </div>

              @if (passwordMismatch()) {
                <p class="mt-1 text-xs text-red-500">
                  Las contrase√±as no coinciden.
                </p>
              }
            </div>
          </div>

          <div class="mt-8">
            <button
              type="button"
              class="w-full rounded-full px-6 py-3 bg-[#0a0d12] text-white font-semibold disabled:opacity-40 disabled:cursor-not-allowed"
              [disabled]="isLoading() || datosForm.invalid || credencialesForm.invalid"
              (click)="finish()"
            >
              @if (isLoading()) { Registrando... } @else { Confirmar }
            </button>
          </div>
        </div>
      }
    }
  </div>
</div>
